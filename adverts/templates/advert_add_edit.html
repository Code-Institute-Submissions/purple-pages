<!-- Add or Edit Advert Template -->
{% extends 'base.html' %}
{% block main-content %}
<div class="columns is-centered">
    <div class="column is-three-quarters-tablet is-half-desktop">
        <div class="box">
            <p>Complete the form below to create new advert.</p>
            <form action="{{ request.path }}" method="POST" class="form">
                {% include "bulma_form_template.html" with form=advert_form %}
                {% csrf_token %}
                <hr>
                <div class="field level">
                    <div class="level-left">
                        <div class="control level-item">
                            <a href="{% url 'my_ads' %}" class="button is-warning">Cancel</a>
                        </div>
                    </div>
                    <div class="level-right">
                        <div class="control level-item">
                            <button class="button is-link">Create</button>
                        </div>      
                    </div>                                                   
                </div>                             
            </form>
        </div>        
    </div>  
</div>


    Preview Area
    <div id="get-preview" class="button">Get Preview</div>
    <div id="preview-area"></div>    
{% endblock %}

{% block scripts %}
    <script>
        $('#get-preview').click(function() {
            // Get CSRF token from DOM
            let csrfToken = $("[name=csrfmiddlewaretoken]").val();
            // Build up the POST request data from the form elements
            let postData = {}
            $('form input, textarea, select').each(function(inputElement) {
                postData[this.name] = this.value
            })
            // Add address of existing image if there is one
            postData['image'] = $('[type=file]').siblings('a').attr('href')
            console.log(postData)
            // Make ajax request for advert preview
            $.post("{% url 'preview_advert' %}", postData , function(preview) {
                $('#preview-area').html(preview);             
            });            
        });
    </script>
{% endblock %}